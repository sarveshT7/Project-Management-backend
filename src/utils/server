// // src/server.ts
// import express from 'express';
// import cors from 'cors';
// import helmet from 'helmet';
// import morgan from 'morgan';
// import rateLimit from 'express-rate-limit';
// import compression from 'compression';
// import dotenv from 'dotenv';

// // Import database connections
// import './config/database';
// import './config/redis';

// // Import middleware
// import errorHandler from './middleware/errorHandler';
// import notFound from './middleware/notFound';

// // Import routes
// import authRoutes from './routes/auth.routes';
// import projectRoutes from './routes/project.routes';
// import taskRoutes from './routes/task.routes';
// import teamRoutes from './routes/team.routes';
// import userRoutes from './routes/user.routes';
// import dashboardRoutes from './routes/dashboard.routes';
// import analyticsRoutes from './routes/analytics.routes';
// import settingsRoutes from './routes/settings.routes';

// // Load environment variables
// dotenv.config();

// const app = express();

// // Trust proxy for production deployment
// app.set('trust proxy', 1);

// // Security middleware
// app.use(helmet({
//   crossOriginResourcePolicy: { policy: "cross-origin" }
// }));

// // CORS configuration
// const corsOptions = {
//   origin: process.env.NODE_ENV === 'production' 
//     ? process.env.FRONTEND_URL?.split(',') || []
//     : ['http://localhost:3000', 'http://localhost:3001', 'http://127.0.0.1:3000'],
//   credentials: true,
//   methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
//   allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
//   exposedHeaders: ['X-Total-Count']
// };

// app.use(cors(corsOptions));

// // Rate limiting
// const limiter = rateLimit({
//   windowMs: 15 * 60 * 1000, // 15 minutes
//   max: process.env.NODE_ENV === 'production' ? 100 : 1000, // requests per windowMs
//   message: {
//     success: false,
//     message: 'Too many requests from this IP, please try again later.'
//   },
//   standardHeaders: true,
//   legacyHeaders: false,
// });

// app.use('/api', limiter);

// // Body parsing middleware
// app.use(express.json({ limit: '10mb' }));
// app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// // Compression middleware
// app.use(compression());

// // Logging middleware
// if (process.env.NODE_ENV === 'development') {
//   app.use(morgan('dev'));
// } else {
//   app.use(morgan('combined'));
// }

// // Health check endpoint
// app.get('/health', (req, res) => {
//   res.status(200).json({
//     success: true,
//     message: 'Server is healthy',
//     timestamp: new Date().toISOString(),
//     uptime: process.uptime()
//   });
// });

// // API routes
// app.use('/api/auth', authRoutes);
// app.use('/api/projects', projectRoutes);
// app.use('/api/tasks', taskRoutes);
// app.use('/api/teams', teamRoutes);
// app.use('/api/users', userRoutes);
// app.use('/api/dashboard', dashboardRoutes);
// app.use('/api/analytics', analyticsRoutes);
// app.use('/api/settings', settingsRoutes);

// // Root route
// app.get('/', (req, res) => {
//   res.json({
//     success: true,
//     message: 'Project Management API',
//     version: '1.0.0',
//     endpoints: {
//       auth: '/api/auth',
//       projects: '/api/projects',
//       tasks: '/api/tasks',
//       teams: '/api/teams',
//       users: '/api/users',
//       dashboard: '/api/dashboard',
//       analytics: '/api/analytics',
//       settings: '/api/settings'
//     }
//   });
// });

// // 404 handler
// app.use(notFound);

// // Error handling middleware (must be last)
// app.use(errorHandler);

// const PORT = process.env.PORT || 5000;

// // Graceful shutdown
// process.on('SIGTERM', () => {
//   console.log('SIGTERM received, shutting down gracefully');
//   process.exit(0);
// });

// process.on('SIGINT', () => {
//   console.log('SIGINT received, shutting down gracefully');
//   process.exit(0);
// });

// // Start server
// app.listen(PORT, () => {
//   console.log(`ğŸš€ Server running on port ${PORT} in ${process.env.NODE_ENV || 'development'} mode`);
  
//   if (process.env.NODE_ENV === 'development') {
//     console.log(`ğŸ“š API Documentation: http://localhost:${PORT}`);
//     console.log(`ğŸ¥ Health Check: http://localhost:${PORT}/health`);
//   }
// });

// export default app;